<!DOCTYPE html>
<html>
  <head>
    <title>Nutrizionista</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <%= javascript_include_tag "application", defer: true %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    

    <%= javascript_importmap_tags %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload" %>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >

    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    >

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      defer
    ></script>
  </head>

  <body>
<%= render "shared/flash" %>

    <!-- ‚≠ê FLASH MESSAGE PREMIUM -->
    

    <!-- ‚≠ê AUTO-HIDE FLASH -->
    <script>
      document.addEventListener("turbo:load", () => {
        document.querySelectorAll(".flash-premium").forEach((flash) => {
          setTimeout(() => {
            flash.style.transition = "opacity 0.6s ease, transform 0.6s ease";
            flash.style.opacity = "0";
            flash.style.transform = "translateY(-20px)";
            setTimeout(() => flash.remove(), 700);
          }, 3000);
        });
      });
    </script>

    <!-- ‚≠ê NAVBAR -->
    <nav id="mainNavbar" class="navbar navbar-expand-lg premium-navbar">
      <div class="container">

        <a class="navbar-brand d-flex align-items-center gap-2" href="<%= root_path %>">
          <%= image_tag "logo_francesca_vitale.png",
                alt: "Francesca Vitale",
                class: "logo-navbar" %>
        </a>

        <button class="navbar-toggler bg-light" type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
          <ul class="navbar-nav">

            <!-- üîê LINK ADMIN -->
            <% if current_user&.admin? %>
              <li class="nav-item">
                <%= link_to "Dashboard",
                      admin_free_consultations_path,
                      class: "nav-link" %>
              </li>

              <li class="nav-item">
                <%= link_to "Slot consulenze",
                      admin_availability_slots_path,
                      class: "nav-link" %>
              </li>
            <% end %>

            <li class="nav-item">
              <%= link_to "Chi Sono", chi_sono_path, class: "nav-link" %>
            </li>

            <% if logged_in? %>
              <li class="nav-item">
  <%= form_with url: logout_path, method: :delete, class: "d-inline" do %>
    <%= submit_tag "Logout",
          class: "nav-link text-warning fw-bold border-0 bg-transparent",
          data: { confirm: "Vuoi davvero uscire?" } %>
  <% end %>
</li>


              
            <% else %>
              <li class="nav-item">
                <%= link_to "Login", login_path, class: "nav-link" %>
              </li>

              <li class="nav-item">
                <%= link_to "Registrazione", signup_path, class: "nav-link" %>
              </li>
            <% end %>

          </ul>
        </div>
      </div>
    </nav>

    <!-- CONTENUTO -->
    <%= yield %>

    <!-- ‚≠ê FOOTER -->
    <footer class="text-white mt-5" style="background-color:#4B0082;">
      <div class="container py-4">
        <div class="row">

          <div class="col-md-4 mb-3">
            <h5 class="fw-bold">Studio Vitale</h5>
            <p class="mb-1">Dietologa ‚Äì Francesca Vitale</p>
            <p class="mb-1">P. IVA: 12345678901</p>
            <p class="mb-1">Email: info@vitalefrancesca.com</p>
            <p class="mb-0">Telefono: +39 333 123 4567</p>
          </div>

          <div class="col-md-4 mb-3">
            <h5 class="fw-bold">Menu</h5>
            <ul class="list-unstyled">
              <li><a href="<%= chi_sono_path %>" class="footer-link">Chi Sono</a></li>
              <li><a href="#" class="footer-link">Servizi</a></li>
              <li><a href="#" class="footer-link">Prenota</a></li>
              <li><a href="#" class="footer-link">Contatti</a></li>
            </ul>
          </div>

          <div class="col-md-4 mb-3">
            <h5 class="fw-bold">Seguimi</h5>
            <div class="d-flex gap-3 mt-2">
              <a href="#" class="footer-social"><i class="bi bi-instagram"></i></a>
              <a href="#" class="footer-social"><i class="bi bi-facebook"></i></a>
              <a href="#" class="footer-social"><i class="bi bi-youtube"></i></a>
            </div>
          </div>

        </div>

        <hr class="border-light">

        <div class="text-center small">
          ¬© <%= Time.current.year %> Studio Vitale ‚Äì Tutti i diritti riservati
        </div>
      </div>
    </footer>

    <!-- ‚≠ê NAVBAR SCROLL -->
    <script>
      document.addEventListener("scroll", () => {
        const navbar = document.getElementById("mainNavbar");
        window.scrollY > 50
          ? navbar.classList.add("navbar-scrolled")
          : navbar.classList.remove("navbar-scrolled");
      });
    </script>

    <!-- ‚≠ê STILI NAVBAR -->
    <style>
      .premium-navbar {
        position: sticky;
        top: 0;
        z-index: 1000;
        background-color: rgba(75, 0, 130, 0.85);
        backdrop-filter: blur(6px);
        padding: 16px 0;
        transition: all 0.35s ease-in-out;
      }

      .premium-navbar .nav-link,
      .premium-navbar .navbar-brand {
        color: white !important;
        font-weight: 500;
      }

      .navbar-scrolled {
        background-color: rgba(75, 0, 130, 0.97) !important;
        padding: 6px 0 !important;
        box-shadow: 0 6px 25px rgba(0,0,0,0.25);
      }

      .logo-navbar {
        height: 56px;
        transition: transform 0.2s ease;
      }

      .logo-navbar:hover {
        transform: scale(1.05);
      }

      @media (max-width: 768px) {
        .logo-navbar {
          height: 40px;
        }
      }
    </style>



 <!-- MODAL CONFERMA ELIMINAZIONE -->
<div id="confirm-delete-modal" class="modal">
  <div class="modal-content">
    <h5>‚ö†Ô∏è Elimina nota clinica</h5>
    <p>
      Questa operazione √® <strong>definitiva</strong>.<br>
      Vuoi davvero eliminare questa nota?
    </p>
  </div>

  <div class="modal-footer">
    <a href="#!" class="modal-close btn-flat">
      Annulla
    </a>

    <form id="confirm-delete-form" method="post">
      <!-- Rails method override -->
      <input type="hidden" name="_method" value="delete">

      <!-- CSRF token -->
      <input type="hidden"
             name="authenticity_token"
             value="<%= form_authenticity_token %>">

      <button type="submit" class="btn red">
        Elimina
      </button>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // inizializza Materialize modal
    var elems = document.querySelectorAll(".modal");
    M.Modal.init(elems);

    // collega i pulsanti "Elimina"
    document.querySelectorAll(".open-delete-modal").forEach(function (btn) {
      btn.addEventListener("click", function () {
        var actionUrl = this.dataset.action;
        var form = document.getElementById("confirm-delete-form");

        // imposta l'action corretta (DELETE)
        form.setAttribute("action", actionUrl);
      });
    });
  });
</script>



  </body>
</html>

