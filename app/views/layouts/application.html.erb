<!DOCTYPE html>
<html>
  <head>
    <title>Nutrizionista</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- CSS principale -->
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

    <!-- Importmap (Rails 7) -->
    <%= javascript_importmap_tags %>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >

    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    >

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      defer
    ></script>

    <!-- Materialize JS (solo per modali) -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"
      defer
    ></script>
  </head>

  <body>

    <!-- FLASH -->
    <%= render "shared/flash" %>

    <!-- AUTO-HIDE FLASH -->
    <script>
      document.addEventListener("turbo:load", () => {
        document.querySelectorAll(".flash-premium").forEach((flash) => {
          setTimeout(() => {
            flash.style.transition = "opacity 0.6s ease, transform 0.6s ease";
            flash.style.opacity = "0";
            flash.style.transform = "translateY(-20px)";
            setTimeout(() => flash.remove(), 700);
          }, 3000);
        });
      });
    </script>

    <!-- =========================
         NAVBAR (NASCOSTA SU AUTH)
         ========================= -->
    <% unless @hide_navbar %>
      <nav id="mainNavbar" class="navbar navbar-expand-lg premium-navbar">
        <div class="container">

          <a class="navbar-brand d-flex align-items-center gap-2" href="<%= root_path %>">
            <%= image_tag "logo_francesca_vitale.png",
                  alt: "Francesca Vitale",
                  class: "logo-navbar" %>
          </a>

          <button class="navbar-toggler bg-light" type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">

              <% if current_user&.admin? %>
                <li class="nav-item">
                  <%= link_to "Dashboard",
                        admin_free_consultations_path,
                        class: "nav-link" %>
                </li>

                <li class="nav-item">
                  <%= link_to "Slot consulenze",
                        admin_availability_slots_path,
                        class: "nav-link" %>
                </li>
              <% end %>

              <li class="nav-item">
                <%= link_to "Chi Sono", chi_sono_path, class: "nav-link" %>
              </li>

              <% if logged_in? %>
                <li class="nav-item">
                  <%= form_with url: logout_path, method: :delete, class: "d-inline" do %>
                    <%= submit_tag "Logout",
                          class: "nav-link text-warning fw-bold border-0 bg-transparent",
                          data: { confirm: "Vuoi davvero uscire?" } %>
                  <% end %>
                </li>
              <% else %>
                <li class="nav-item">
                  <%= link_to "Login", login_path, class: "nav-link" %>
                </li>

                <li class="nav-item">
                  <%= link_to "Registrazione", signup_path, class: "nav-link" %>
                </li>
              <% end %>

            </ul>
          </div>
        </div>
      </nav>
    <% end %>

    <!-- =========================
         CONTENUTO PAGINA
         ========================= -->
    <%= yield %>

    <!-- =========================
         FOOTER (NASCOSTO SU AUTH)
         ========================= -->
    <% unless @hide_footer %>
      <footer class="text-white mt-5" style="background-color:#4B0082;">
        <div class="container py-4">
          <div class="row">

            <div class="col-md-4 mb-3">
              <h5 class="fw-bold">Studio Vitale</h5>
              <p class="mb-1">Dietologa – Francesca Vitale</p>
              <p class="mb-1">P. IVA: 12345678901</p>
              <p class="mb-1">Email: info@vitalefrancesca.com</p>
              <p class="mb-0">Telefono: +39 333 123 4567</p>
            </div>

            <div class="col-md-4 mb-3">
              <h5 class="fw-bold">Menu</h5>
              <ul class="list-unstyled">
                <li><a href="<%= chi_sono_path %>" class="footer-link">Chi Sono</a></li>
                <li><a href="#" class="footer-link">Servizi</a></li>
                <li><a href="#" class="footer-link">Prenota</a></li>
                <li><a href="#" class="footer-link">Contatti</a></li>
              </ul>
            </div>

            <div class="col-md-4 mb-3">
              <h5 class="fw-bold">Seguimi</h5>
              <div class="d-flex gap-3 mt-2">
                <a href="#" class="footer-social"><i class="bi bi-instagram"></i></a>
                <a href="#" class="footer-social"><i class="bi bi-facebook"></i></a>
                <a href="#" class="footer-social"><i class="bi bi-youtube"></i></a>
              </div>
            </div>

          </div>

          <hr class="border-light">

          <div class="text-center small">
            © <%= Time.current.year %> Studio Vitale – Tutti i diritti riservati
          </div>
        </div>
      </footer>
    <% end %>

    <!-- NAVBAR SCROLL EFFECT -->
    <script>
      document.addEventListener("scroll", () => {
        const navbar = document.getElementById("mainNavbar");
        if (!navbar) return;

        window.scrollY > 50
          ? navbar.classList.add("navbar-scrolled")
          : navbar.classList.remove("navbar-scrolled");
      });
    </script>

  </body>
</html>


